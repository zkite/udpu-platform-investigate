# Проверка UI функционала для ролей

## Найденные проблемы

1. **Создание/редактирование GHN ports через таблицу**: при пустом списке портов в редакторе автоматически создаётся строка с `vb = True`, что приводит к сохранению записи без интерфейсов (поля пустые), но с флагом `vb`. Это добавляет порт, которого пользователь фактически не вводил. Исправлено так, чтобы строка по умолчанию создавалась с `vb = False`.

## Изменения

- Обновлён дефолт для пустой таблицы GHN ports на `vb = False`, чтобы пустая строка не попадала в сохранённые данные, если пользователь её не заполнил.

**Summary**
* Исправлен дефолт `vb` для пустой строки в редакторе GHN ports, чтобы избежать сохранения незаполненной записи.【F:frontend/app.py†L393-L429】
* Зафиксированы результаты проверки UI ролей в отчёте.【F:md/ROLE_UI_AUDIT.MD†L1-L9】

**Testing**
* ⚠️ `not run (not requested)`

## Соответствие UI функционалу roles API

### Несоответствия и пробелы

1. **Поля `wireguard_tunnel` и `job_control` отсутствуют в UI.**
   - API принимает и хранит эти флаги в `UdpuRole` и `UdpuRoleUpdate`, а UI не предоставляет элементы управления и не отправляет эти значения.
   - В результате при создании/редактировании роль всегда сохраняется с дефолтом `False` для обоих полей.

2. **`interfaces` недоступны для обновления через PATCH по контракту API.**
   - UI отправляет `interfaces` в PATCH-запросе, но схема `UdpuRoleUpdate` не содержит `interfaces`, поэтому данные интерфейсов при обновлении будут игнорированы сервером.

3. **Несовпадение дефолта `management_vlan.interface`.**
   - API по умолчанию использует `br-lan`, тогда как UI подставляет `vlan`.
   - Это создаёт расхождение в дефолтных данных при создании роли без заполнения поля.

4. **Нет UI для клонирования ролей.**
   - API реализует `POST /roles/clone`, но в UI отсутствует соответствующий функционал.

### Соответствие

- UI поддерживает базовые операции: список ролей, просмотр, создание, удаление, обновление (с возможностью переименования). Эти операции соответствуют `GET /roles`, `GET /roles/{name}`, `POST /roles`, `PATCH /roles/{name}`, `DELETE /roles/{name}`.

## Приведение UI к функционалу roles API

- Добавлены поля `wireguard_tunnel` и `job_control` в форму роли и отображение в деталях, чтобы UI покрывал флаги, поддерживаемые API.
- Добавлена операция клонирования роли через `POST /roles/clone`.
- Дефолт `management_vlan.interface` в UI приведён к значению `br-lan`, как в серверной схеме.
- PATCH-обновление теперь корректно поддерживает `interfaces` на стороне API через расширение схемы обновления.
